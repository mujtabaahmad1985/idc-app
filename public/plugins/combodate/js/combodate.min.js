!function($){var t=function(t,e){return this.$element=$(t),this.$element.is("input")?(this.options=$.extend({},$.fn.combodate.defaults,e,this.$element.data()),void this.init()):void $.error("Combodate should be applied to INPUT element")};t.prototype={constructor:t,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]},this.$widget=$('<span class="combodate"></span>').html(this.getTemplate()),this.initCombos(),this.datetime=null,this.$widget.on("change","select",$.proxy(function(t){this.$element.val(this.getValue()).change(),this.options.smartDays&&($(t.target).is(".month")||$(t.target).is(".year"))&&this.fillCombo("day")},this)),this.$widget.find("select").css("width","auto"),this.$element.hide().after(this.$widget),this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var t=this.options.template,e=this.$element.prop("disabled"),i=this.options.customClass;return $.each(this.map,function(e,i){i=i[0];var o=new RegExp(i+"+"),s=i.length>1?i.substring(1,2):i;t=t.replace(o,"{"+s+"}")}),t=t.replace(/ /g,"&nbsp;"),$.each(this.map,function(o,s){s=s[0];var n=s.length>1?s.substring(1,2):s;t=t.replace("{"+n+"}",'<select class="'+o+" "+i+'"'+(e?' disabled="disabled"':"")+"></select>")}),t},initCombos:function(){for(var t in this.map){var e=this.$widget.find("."+t);this["$"+t]=e.length?e:null,this.fillCombo(t)}},fillCombo:function(t){var e=this["$"+t];if(e){var i="fill"+t.charAt(0).toUpperCase()+t.slice(1),o=this[i](),s=e.val();e.empty();for(var n=0;n<o.length;n++)e.append('<option value="'+o[n][0]+'">'+o[n][1]+"</option>");e.val(s)}},fillCommon:function(t){var e=[],i;if("name"===this.options.firstItem){i=moment.localeData?moment.localeData()._relativeTime:moment.relativeTime||moment.langData()._relativeTime;var o="function"==typeof i[t]?i[t](1,!0,t,!1):i[t];o=o.split(" ").reverse()[0],e.push(["",o])}else"empty"===this.options.firstItem&&e.push(["",""]);return e},fillDay:function(){var t=this.fillCommon("d"),e,i,o=-1!==this.options.template.indexOf("DD"),s=31;if(this.options.smartDays&&this.$month&&this.$year){var n=parseInt(this.$month.val(),10),a=parseInt(this.$year.val(),10);isNaN(n)||isNaN(a)||(s=moment([a,n]).daysInMonth())}for(i=1;s>=i;i++)e=o?this.leadZero(i):i,t.push([i,e]);return t},fillMonth:function(){var t=this.fillCommon("M"),e,i,o=-1!==this.options.template.indexOf("MMMMMM"),s=-1!==this.options.template.indexOf("MMMMM"),n=-1!==this.options.template.indexOf("MMMM"),a=-1!==this.options.template.indexOf("MMM"),r=-1!==this.options.template.indexOf("MM");for(i=0;11>=i;i++)e=o?moment().date(1).month(i).format("MM - MMMM"):s?moment().date(1).month(i).format("MM - MMM"):n?moment().date(1).month(i).format("MMMM"):a?moment().date(1).month(i).format("MMM"):r?this.leadZero(i+1):i+1,t.push([i,e]);return t},fillYear:function(){var t=[],e,i,o=-1!==this.options.template.indexOf("YYYY");for(i=this.options.maxYear;i>=this.options.minYear;i--)e=o?i:(i+"").substring(2),t[this.options.yearDescending?"push":"unshift"]([i,e]);return t=this.fillCommon("y").concat(t)},fillHour:function(){var t=this.fillCommon("h"),e,i,o=-1!==this.options.template.indexOf("h"),s=-1!==this.options.template.indexOf("H"),n=-1!==this.options.template.toLowerCase().indexOf("hh"),a=o?1:0,r=o?12:23;for(i=a;r>=i;i++)e=n?this.leadZero(i):i,t.push([i,e]);return t},fillMinute:function(){var t=this.fillCommon("m"),e,i,o=-1!==this.options.template.indexOf("mm");for(i=0;59>=i;i+=this.options.minuteStep)e=o?this.leadZero(i):i,t.push([i,e]);return t},fillSecond:function(){var t=this.fillCommon("s"),e,i,o=-1!==this.options.template.indexOf("ss");for(i=0;59>=i;i+=this.options.secondStep)e=o?this.leadZero(i):i,t.push([i,e]);return t},fillAmpm:function(){var t=-1!==this.options.template.indexOf("a"),e=-1!==this.options.template.indexOf("A"),i=[["am",t?"am":"AM"],["pm",t?"pm":"PM"]];return i},getValue:function(t){var e,i={},o=this,s=!1;return $.each(this.map,function(t,e){if("ampm"!==t){if(o["$"+t])i[t]=parseInt(o["$"+t].val(),10);else{var n;n=o.datetime?o.datetime[e[1]]():"day"===t?1:0,i[t]=n}return isNaN(i[t])?(s=!0,!1):void 0}}),s?"":(this.$ampm&&(12===i.hour?i.hour="am"===this.$ampm.val()?0:12:i.hour="am"===this.$ampm.val()?i.hour:i.hour+12),e=moment([i.year,i.month,i.day,i.hour,i.minute,i.second]),this.highlight(e),t=void 0===t?this.options.format:t,null===t?e.isValid()?e:null:e.isValid()?e.format(t):"")},setValue:function(t){function e(t,e){var i={};return t.children("option").each(function(t,o){var s=$(o).attr("value"),n;""!==s&&(n=Math.abs(s-e),("undefined"==typeof i.distance||n<i.distance)&&(i={value:s,distance:n}))}),i.value}if(t){var i="string"==typeof t?moment(t,this.options.format,!0):moment(t),o=this,s={};i.isValid()?($.each(this.map,function(t,e){"ampm"!==t&&(s[t]=i[e[1]]())}),this.$ampm&&(s.hour>=12?(s.ampm="pm",s.hour>12&&(s.hour-=12)):(s.ampm="am",0===s.hour&&(s.hour=12))),$.each(s,function(t,i){o["$"+t]&&("minute"===t&&o.options.minuteStep>1&&o.options.roundTime&&(i=e(o["$"+t],i)),"second"===t&&o.options.secondStep>1&&o.options.roundTime&&(i=e(o["$"+t],i)),o["$"+t].val(i))}),this.options.smartDays&&this.fillCombo("day"),this.$element.val(i.format(this.options.format)).change(),this.datetime=i):this.datetime=null}},highlight:function(t){t.isValid()?this.options.errorClass?this.$widget.removeClass(this.options.errorClass):this.$widget.find("select").css("border-color",this.borderColor):this.options.errorClass?this.$widget.addClass(this.options.errorClass):(this.borderColor||(this.borderColor=this.$widget.find("select").css("border-color")),this.$widget.find("select").css("border-color","red"))},leadZero:function(t){return 9>=t?"0"+t:t},destroy:function(){this.$widget.remove(),this.$element.removeData("combodate").show()}},$.fn.combodate=function(e){var i,o=Array.apply(null,arguments);return o.shift(),"getValue"===e&&this.length&&(i=this.eq(0).data("combodate"))?i.getValue.apply(i,o):this.each(function(){var i=$(this),s=i.data("combodate"),n="object"==typeof e&&e;s||i.data("combodate",s=new t(this,n)),"string"==typeof e&&"function"==typeof s[e]&&s[e].apply(s,o)})},$.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,yearDescending:!0,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,customClass:"",roundTime:!0,smartDays:!1}}(window.jQuery);