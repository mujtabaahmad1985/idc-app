!function($){"use strict";var t={inboxContent:$("#inbox-content"),pageTitle:$(".page-title"),fileInboxList:"page-inbox-list.html",fileInboxMessage:"page-inbox-message.html",fileInboxReply:"page-inbox-reply.html",fileInboxListSent:"page-inbox-list-sent.html",fileInboxListSpam:"page-inbox-list-spam.html",fileInboxListTrash:"page-inbox-list-trash.html",fileInboxListStarred:"page-inbox-list-starred.html",cc:'<div class="form-group"><div class="input-group"><span class="input-group-addon">CC: </span><input type="text" class="form-control" name="cc"><span class="input-group-addon"><i class="icon-close" data-action="cc-close"></i></span></div></div>',bcc:'<div class="form-group"><div class="input-group"><span class="input-group-addon">BCC: </span><input type="text" class="form-control" name="bcc"><span class="input-group-addon"><i class="icon-close" data-action="bcc-close"></i></span></div></div>',init:function(){$.ajax({url:t.fileInboxList,datatype:"html",cache:!1,success:function(e,n,a){t.inboxContent.append(e),t.icheckInit(),t.paginationInit(),$(document).on("click",".nav-inbox [data-action]",t.navInbox).on("click",".table-inbox-list tr",t.message).on("click","#inbox-content .star",t.starIconClick).on("ifChanged",".inbox-list-heading .icheck",t.icheckClick).on("click",".inbox-list-heading [data-action]",t.tableRefresh)},error:function(){alert("Unable to load inbox list")}})},tableRefresh:function(e){var n=$(e.target).attr("data-action"),a,i;a=window.location.pathname,a=a.split("/"),i=a[a.length-1],file=i.indexOf("."),file=i.slice(0,file),"btn-refresh"==n&&(t.blockuiInit(),setTimeout(function(){t.navInboxActivePage(file)},2e3))},blockuiInit:function(){$.blockUI.defaults.timeout=2e3,$.blockUI.defaults.overlayCSS.zIndex=1060,$.blockUI.defaults.overlayCSS.backgroundColor="transparent",$.blockUI.defaults.css.width="auto",$.blockUI.defaults.css.left=0,$.blockUI.defaults.css.right=0,$.blockUI.defaults.css.margin="auto",$.blockUI.defaults.css.border="none",$.blockUI.defaults.css.backgroundColor="transparent",$(".table-inbox-list").block({message:'<i class="fa fa-spinner fa-spin" style="font-size: 30px"></i>',overlayCSS:{"background-color":"#eee"}})},icheckInit:function(){$("input.icheck").iCheck({checkboxClass:"icheckbox_minimal-grey",radioClass:"iradio_minimal-grey"})},icheckClick:function(){$(this).on("ifChecked ifUnchecked",function(t){"ifChecked"==t.type?$(".table-inbox-list .icheck").iCheck("check"):$(".table-inbox-list .icheck").iCheck("uncheck")})},paginationInit:function(){$(".content-wrapper").jplist({itemsBox:".table-inbox-list",itemPath:"tr[data-id]",panelPath:".inbox-list-pagination"})},attachmentInit:function(){$(".attachment-img").magnificPopup({delegate:"a:not(.attachment-item-file)",type:"image",gallery:{enabled:!0}}),$(".attachment-file").magnificPopup({delegate:".attachment-item-file",type:"iframe"})},summernoteInit:function(){$("[data-content='message-editor']").summernote()},starIconClick:function(t){var e=$(this).find(".fa");e.closest("tr")&&(t.stopPropagation(),e.hasClass("fa-star-o")?e.removeClass("fa-star-o").addClass("fa-star"):e.removeClass("fa-star").addClass("fa-star-o"))},message:function(){var e=$(this).attr("data-id");$.ajax({url:t.fileInboxMessage,datatype:"html",cache:!1,success:function(n,a,i){t.inboxContent.empty();var o=$($.parseHTML(n)).find(".panel[data-id='"+e+"']");t.inboxContent.append(o),t.attachmentInit(),t.inboxContent.find("[data-action='btn-reply']").on("click",t.reply)},error:function(){alert("Unable to load the current message")}})},reply:function(){$.ajax({url:t.fileInboxReply,datatype:"html",cache:!1,success:function(e,n,a){var i=t.inboxContent.find("[data-content='recipient']").text(),o=t.inboxContent.find("[data-content='subject']").text(),c=t.inboxContent.find("[data-content='message']").html();t.inboxContent.empty(),t.inboxContent.append(e),t.inboxContent.find(".panel-title > h4").text("Reply"),t.inboxContent.find("input[type='text'][data-content='recipient']").val(i),t.inboxContent.find("input[type='text'][data-content='subject']").val(o),t.inboxContent.find("div[data-content='message-editor']").html(c),t.summernoteInit(),t.fileUpload(),$(document).on("click",".message-reply-heading [data-action]",t.ccbcc)},error:function(){alert("Unable to load the reply form")}})},ccbcc:function(){var e=$(this).closest(".message-reply-heading"),n=$(this).attr("data-action");if("cc"!=n||e.hasClass("has-cc")||e.append(t.cc).addClass("has-cc"),"bcc"!=n||e.hasClass("has-bcc")||e.append(t.bcc).addClass("has-bcc"),"cc-close"==n||"bcc-close"==n){var a=n.indexOf("-");a=n.slice(0,a),$(this).closest(".form-group").remove(),e.removeClass("has-"+a)}},navInbox:function(e){$(e.target).closest("li").addClass("active").siblings().removeClass("active"),t.navItem=$(e.target).attr("data-action")||$(e.target).closest("[data-action]").attr("data-action"),t.navInboxActivePage(t.navItem)},navInboxActivePage:function(e){switch(e){case"compose":t.compose();break;case"inbox":t.inbox();break;case"sent":t.sent();break;case"spam":t.spam();break;case"trash":t.trash();break;case"starred":t.starred()}},compose:function(){$.ajax({url:t.fileInboxReply,datatype:"html",cache:!1,success:function(e,n,a){t.pageTitle.text("Compose"),t.inboxContent.empty().append(e),t.inboxContent.find(".panel-title > h4").text("New message"),t.summernoteInit(),t.fileUpload(),$(document).on("click",".message-reply-heading [data-action]",t.ccbcc)},error:function(){alert("Unable to compose a message")}})},inbox:function(){$.ajax({url:t.fileInboxList,datatype:"html",cache:!1,success:function(e,n,a){t.pageTitle.text("Inbox"),t.inboxContent.empty().append(e),t.icheckInit(),t.paginationInit()},error:function(){alert("Unable to load sent messages")}})},sent:function(){$.ajax({url:t.fileInboxListSent,datatype:"html",cache:!1,success:function(e,n,a){t.pageTitle.text("Sent"),t.inboxContent.empty().append(e),t.icheckInit(),t.paginationInit()},error:function(){alert("Unable to load sent messages")}})},spam:function(){$.ajax({url:t.fileInboxListSpam,datatype:"html",cache:!1,success:function(e,n,a){t.pageTitle.text("Spam"),t.inboxContent.empty().append(e),t.icheckInit(),t.paginationInit()},error:function(){alert("Unable to load messages")}})},trash:function(){$.ajax({url:t.fileInboxListTrash,datatype:"html",cache:!1,success:function(e,n,a){t.pageTitle.text("Trash"),t.inboxContent.empty().append(e),t.icheckInit(),t.paginationInit()},error:function(){alert("Unable to load messages")}})},starred:function(){$.ajax({url:t.fileInboxListStarred,datatype:"html",cache:!1,success:function(e,n,a){t.pageTitle.text("Starred"),t.inboxContent.empty().append(e),t.icheckInit(),t.paginationInit()},error:function(){alert("Unable to load messages")}})},fileUpload:function(){var t=document.querySelector("#template");t.id="";var e=t.parentNode.innerHTML;t.parentNode.removeChild(t);var n=new Dropzone(document.querySelector("#actions"),{url:"page-inbox.html",thumbnailWidth:150,thumbnailHeight:100,parallelUploads:20,previewTemplate:e,autoQueue:!1,previewsContainer:"#previews",clickable:".fileinput-button"});n.on("addedfile",function(t){t.previewElement.querySelector(".start").onclick=function(){n.enqueueFile(t)}}),document.querySelector("#actions .start").onclick=function(){n.enqueueFiles(n.getFilesWithStatus(Dropzone.ADDED))},document.querySelector("#actions .cancel").onclick=function(){n.removeAllFiles(!0)}}};t.init()}(jQuery);